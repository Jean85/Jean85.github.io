<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Why type hints and interfaces are not visual debt - Alessandro Lai</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://alessandrolai.dev/posts/visual-debt-typehints/">
  <meta property="og:site_name" content="Alessandro Lai">
  <meta property="og:title" content="Why type hints and interfaces are not visual debt">
  <meta property="og:description" content="A few days ago I stumbled on a strange tweet that was highlighting a controversy about scalar type hints.
Scalar type hints &amp; return types vs no scalar type hints &amp; return types is #PHP&#39;s new spaces vs tabs
— Cees-Jan 🔊 Kiewiet (@WyriHaximus)
After asking references about this, someone alluded to this very short video: “PHP Bits: Visual Debt” (it’s only 3 minutes, please watch it before continue reading). After that, the author of the video was dragged into the conversation, and it blew up into a big tweetstorm in the following few hours.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2017-05-31T00:00:00+00:00">
    <meta property="article:modified_time" content="2017-05-31T00:00:00+00:00">
    <meta property="article:tag" content="PHP">
    <meta property="article:tag" content="OOP">
    <meta property="article:tag" content="Software Testing">
    <meta property="og:image" content="https://alessandrolai.dev/images/avatar-alessandro-lai-square.jpg">

		
  <meta itemprop="name" content="Why type hints and interfaces are not visual debt">
  <meta itemprop="description" content="A few days ago I stumbled on a strange tweet that was highlighting a controversy about scalar type hints.
Scalar type hints &amp; return types vs no scalar type hints &amp; return types is #PHP&#39;s new spaces vs tabs
— Cees-Jan 🔊 Kiewiet (@WyriHaximus)
After asking references about this, someone alluded to this very short video: “PHP Bits: Visual Debt” (it’s only 3 minutes, please watch it before continue reading). After that, the author of the video was dragged into the conversation, and it blew up into a big tweetstorm in the following few hours.">
  <meta itemprop="datePublished" content="2017-05-31T00:00:00+00:00">
  <meta itemprop="dateModified" content="2017-05-31T00:00:00+00:00">
  <meta itemprop="wordCount" content="2218">
  <meta itemprop="image" content="https://alessandrolai.dev/images/avatar-alessandro-lai-square.jpg">
  <meta itemprop="keywords" content="PHP,OOP,Software Testing">
		
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://alessandrolai.dev/images/avatar-alessandro-lai-square.jpg">
  <meta name="twitter:title" content="Why type hints and interfaces are not visual debt">
  <meta name="twitter:description" content="A few days ago I stumbled on a strange tweet that was highlighting a controversy about scalar type hints.
Scalar type hints &amp; return types vs no scalar type hints &amp; return types is #PHP&#39;s new spaces vs tabs
— Cees-Jan 🔊 Kiewiet (@WyriHaximus)
After asking references about this, someone alluded to this very short video: “PHP Bits: Visual Debt” (it’s only 3 minutes, please watch it before continue reading). After that, the author of the video was dragged into the conversation, and it blew up into a big tweetstorm in the following few hours.">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/pr-66-fixes.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="Alessandro Lai" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/images/logo-alessandro-lai.jpg">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Alessandro Lai</div>
					<div class="logo__tagline">Personal site, blog, slide storage, rant box</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/who-am-i/">
				
				<span class="menu__text">Who am I</span>
				
			</a>
		</li>
		<li class="menu__item menu__item--active">
			<a class="menu__link" href="/posts/">
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/talks/">
				
				<span class="menu__text">Talks</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
    <article class="post">
        <header class="post__header">
            <h1 class="post__title">Why type hints and interfaces are not visual debt</h1>
            <div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 1 1 0 28 1 1 0 0 1 0-28m0 3a3 3 0 1 0 0 22 3 3 0 0 0 0-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class="meta__text" datetime="2017-05-31T00:00:00Z">May 31, 2017</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/republished/" rel="category">Republished</a>
	</span>
</div></div>
        </header>
        <div class="content clearfix">
            <blockquote>
                <p>
                    This post was originally published on the
                    <a href="https://engineering.facile.it/blog/eng/visual-debt-typehints/" target="_blank">Facile.it Engineering blog</a>.
                </p>
            </blockquote>
        </div><div class="content post__content clearfix">
            <p>A few days ago I stumbled on a strange tweet that was highlighting a controversy about scalar type hints.</p>
<blockquote>
<p>Scalar type hints &amp; return types vs no scalar type hints &amp; return types is #PHP's new spaces vs tabs</p>
<p>— Cees-Jan 🔊 Kiewiet (@WyriHaximus)</p></blockquote>
<p>After asking references about this, someone alluded to this very short video: <a href="https://laracasts.com/series/php-bits/episodes/1"><strong>&ldquo;PHP Bits: Visual Debt&rdquo;</strong></a> (it&rsquo;s only 3 minutes, please watch it before continue reading). After that, the author of the video was dragged into the conversation, and it blew up into a big tweetstorm in the following few hours.</p>
<p>The core of the controversy was the fact that the author of the video classified as <em><strong>visual debt</strong></em> a lot of stuff in his PHP example, like interfaces, scalar type hints and the final keyword.</p>
<h2 id="my-opinion-on-the-matter">My opinion on the matter</h2>
<p>I can agree with the bottom line of the video:</p>
<blockquote>
<p>Am I necessarily getting a benefit [&hellip;] ?  Question everything</p></blockquote>
<p>Every choice in our line of work is always a <strong>trade-off</strong> between benefits and cons, and every new introduction in a projects should be evaluated and agreed upon between team members. But my personal preference leans a lot towards the opposite side in this specific matter: as I stated in a <a href="https://alessandrolai.dev/posts/how-php-7-tdd-helped-me-sleep-better/">previous blog post here</a>, I love the new additions that PHP 7 brought to us like scalar and return type hints, and I use them as often as I can, because I discovered that <strong>they bring a lot of benefits</strong> to the code that I write.</p>
<p>Probably this was influenced by the fact that previously I worked with C++, where types are a lot more intrusive compared with PHP 5; but over time and with usage, I learned the great benefits that we can achieve with this addition to our PHP 7 codebases. In general, I think that type hints, and other language features that create a more &ldquo;rigid&rdquo; code, are <strong>helpful during the evolution of a codebase</strong>, and so they are really needed in long-running projects, where the maintainability of code is crucial. It may be less true in a &ldquo;release and forget&rdquo; type of project, but I think that it would still be like betting againt oneself.</p>
<p>In this blog post I would like to explain myself and the reasons behind my arguments, recounting them.</p>
<h2 id="scalar-type-hints-as-safeguards">Scalar type hints as safeguards</h2>
<p>In the video, the example had all along this class:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Event</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">EventInterface</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> $events <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">string</span> $name, <span style="color:#a6e22e">callable</span> $handler)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">events</span>[$name][] <span style="color:#f92672">=</span> $handler;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fire</span>(<span style="color:#a6e22e">string</span> $name)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span> <span style="color:#a6e22e">array_key_exists</span>($name, $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">events</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">events</span>[$name] <span style="color:#66d9ef">as</span> $event) {
</span></span><span style="display:flex;"><span>            $event();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The author suggests to remove all type hints, since the code should still work and you could get rid of a lot of additional, not needed complications. I disagree completely with this.</p>
<p><strong>Type hints are safeguards</strong> here, because they let you reduce to the bare minimum all the checks that you should do here before accepting the input arguments:</p>
<ul>
<li>because it&rsquo;s used as a key for an array, <code>$name</code> can only be a string (or an int, but it would not make sense)</li>
<li>the <code>events</code> property can only accept callables, because its elements are invoked inside the foreach of the <code>fire()</code> method</li>
<li>because we don&rsquo;t need to insert additional <code>if</code>s in our methods, we <strong>reduce the number of possible paths of execution</strong>, hence reducing the number of cases that we need to check in our tests.</li>
</ul>
<h2 id="type-hints-and-interfaces-as-contracts">Type hints and interfaces as contracts</h2>
<p>In the video, it was suggested to also get rid of the interface:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">EventInterface</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">string</span> $name, <span style="color:#a6e22e">callable</span> $handler)<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fire</span>(<span style="color:#a6e22e">string</span> $name)<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I agree that <strong>an interface should be written only if needed</strong>, like if you want to write multiple concrete implementation of it with different inheritance hierarchy. But this doesn&rsquo;t mean that we will not have any interface at all: we still have the concrete implementation.</p>
<p>That is not the same of having a pure interface, but we will still be able to determine a <strong>contract</strong>, a list of method signatures that tells us what that object will accept as valid method calls. This kind of contracts are a must in object oriented programming, because they dictate how your object will interconnect, communicate and cooperate, and they are especially useful in combination with stricter type hints and <strong>unit testing</strong>.</p>
<p>When we write unit test, we use the real instance of the class which is under test, and everything else should be mocked. That means that we will use some test mocking library (i.e. I prefer <a href="https://github.com/phpspec/prophecy">Prophecy</a>, which is included in PHPUnit) to mimick the behavior of nearby objects.</p>
<p>How type hints would help us in this case? If we would have to mock the <code>EventInterface</code> (or the concrete class, it&rsquo;s unimportant here), having the return type hints for example would help us in <strong>writing good mocks</strong>, and not wrong ones.</p>
<p>But how? Nearly every mocking library creates a mock extending at runtime the original class, since the mock needs to pass every check and type hint as if it was the original class; this means that it can&rsquo;t change the method signature, hence preserving the original return type hint.</p>
<p>This will translate in errors and test failures if we would write a mock that doesn&rsquo;t return the proper type, like in this example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">shout</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">bool</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $event <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Event</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($event<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fire</span>(<span style="color:#e6db74">&#39;shout&#39;</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// someone was listening!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PersonTest</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">PHPUnit\Framework\TestCase</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">testShout</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $event <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prophesize</span>(<span style="color:#a6e22e">EventInterface</span><span style="color:#f92672">::</span><span style="color:#a6e22e">class</span>);
</span></span><span style="display:flex;"><span>        $event<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fire</span>(<span style="color:#e6db74">&#39;shout&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">shouldBeCalled</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        
</span></span><span style="display:flex;"><span>        $person <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Person</span>();
</span></span><span style="display:flex;"><span>        $person<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">shout</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ phpunit
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>1<span style="color:#f92672">)</span> PersonTest::testShout
</span></span><span style="display:flex;"><span>TypeError: Return value of Double<span style="color:#ae81ff">\E</span>ventInterface<span style="color:#ae81ff">\P</span>2118::fire<span style="color:#f92672">()</span> must be a string, null returned
</span></span></code></pre></div><p>This mock, once used, <strong>will make the test fail</strong>. Why? Because the <code>fire()</code> method can only return a boolean, and by default (if not instructed differently) Prophecy&rsquo;s mocks will return <code>null</code>. Without the <code>: bool</code> return type hint, the mock would return <code>null</code> but the test would not fail, and the class under test would silently cast or interpret the return value as <code>false</code>, possibly causing an unintended behavior or a false positive.</p>
<p>This means that having complete type hints in your interfaces and method signatures only <strong>makes your code more cohesive and your unit test more robust</strong>; this kind of enforcing helps a lot also with refactoring, since changing a method&rsquo;s signature would cause failures in all the related tests that include a mock of that interface, as it could become inconsistent and unreliable after this change.</p>
<h2 id="use-interfaces-as-behavior-checks">Use interfaces as behavior checks</h2>
<p>One of the counter example that popped up during the discussion on Twitter was this one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fireman</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Building</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">putOutFire</span>(<span style="color:#a6e22e">Fireman</span> $fireman);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$building<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">putOutFire</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">StrongAndAblePerson</span>()); <span style="color:#75715e">// type error!
</span></span></span></code></pre></div><p>This was cited to show how sometimes type hints can be a hindrance more that something helpful in your code: why a strong, capable person shouldn&rsquo;t be able to put out a fire? Who&rsquo;s the <code>Building</code> class to decide that? Are we maybe violating the Single Responsibility Principle?</p>
<p>I think that this is misguided for a simple reason: it was <strong>wrong to check against a concrete implementation</strong> instead of an interface; and that&rsquo;s not evident because, in my opinion, the example was <strong>cut too short</strong>.</p>
<p>Let&rsquo;s speculate on the content of the <code>putOutFire()</code> method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Building</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">putOutFire</span>(<span style="color:#a6e22e">Fireman</span> $fireman)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $fireman<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">wearProtectiveGear</span>();
</span></span><span style="display:flex;"><span>        $fireman<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">shootWaterAtFlames</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Why we have a type hint in the <code>putOutFire()</code> method? Surely because we want to rely on some method that a <code>Fireman</code> instance would give to us in the method body (i.e. the <code>wearProtectiveGear()</code> and <code>shootWaterAtFlames()</code>); if we remove the type hint, we would have no guarantees that those methods exists on the argument, and we would have to either use a <code>method_exists()</code> call twice (oh, the horror!) or expose our <code>Building</code> class to a possible fatal error.</p>
<p>To take the example further, we can make the <code>StrongAndAblePerson</code> capable of put out a fire if we <strong>extract the needed methods in an interface</strong>, defining a contract of what our <code>putOutFire()</code> needs to know and use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">TrainedFireFighter</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">wearProtectiveGear</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">shootWaterAtFlames</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">void</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StrongAndAblePerson</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">TrainedFireFighter</span> { <span style="color:#f92672">...</span> }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fireman</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">TrainedFireFighter</span> { <span style="color:#f92672">...</span> }
</span></span></code></pre></div><p>&hellip; now we can have the <code>putOutFire()</code> method with a broader type hint, that would accept both a <code>Fireman</code> and any other class that implements the <code>TrainedFireFighter</code> interface:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Building</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">putOutFire</span>(<span style="color:#a6e22e">TrainedFireFighter</span> $firefighter)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="the-final-keyword">The final keyword</h2>
<p>The only point of the video which I find relatable is the remark on the <code>final</code> keyword.</p>
<p>Apart from the funny joke (<em>&ldquo;I&rsquo;m not your daddy!&rdquo;</em>), I find the final keyword <strong>not very usable in closed projects</strong>, since its only usefulness is to impede the extension of some object. When the persons that could work on a codebase are well known and they can be coordinated, I think it&rsquo;s better to leave that liberty to the coders, and just have an agreement on what can and cannot be done with that class.</p>
<p>On the other hand, this keyword becomes useful when we are talking about <strong>open sourced code</strong>: using it is a clear statement that reduces the surface of the API that the library is exposing to end users, in the same way <code>private</code> is limiting access to properties.</p>
<p>Straightforwardly, the maintainer of the code is saying that this class is not extensible, because it may change internally without notice; this concept is also well explained by Marco Pivetta in his signature &ldquo;Extremely defensive PHP&rdquo; talk (which we cited also in our <a href="https://engineering.facile.it/blog/eng/php-day-2017/">previous blog post</a>, <a href="https://ocramius.github.io/extremely-defensive-php/#/90">see related slide here</a>) and <a href="http://ocramius.github.io/blog/when-to-declare-classes-final/">in his blog post about it</a>.</p>
<h2 id="a-practical-example">A practical example</h2>
<p>I would like to conclude this blog post with a practical example. I maintain <a href="https://github.com/facile-it/paraunit/">facile-it/paraunit</a>, a parallelization tool that works on top of PHPUnit. In the past few days I was working on supporting PHPUnit v6, and that lead to bumping the minimum PHP supported version of the package to 7.0: <a href="https://github.com/facile-it/paraunit/pull/93">https://github.com/facile-it/paraunit/pull/93</a>.</p>
<p>Since previously the minimum supported version was PHP 5.3, I took the opportunity to go over the whole codebase and clean it up, using all the new language features that I could now take for granted: <code>::class</code> shortcuts, array short syntax, but more importantly the aforementioned <strong>scalar and return type hints</strong>.</p>
<p>This is the perfect example to show that adding those type hints on already working code made a <strong>non-trivial difference</strong> even if I wasn&rsquo;t changing the objects&rsquo; behavior, and it forced me to fix some of this stuff:</p>
<ul>
<li>it forced me <a href="https://github.com/facile-it/paraunit/pull/93/files#diff-049f05e192bb0dcb9cf59ad2bbd43ceaR79">to define more explicitly a default behavior</a>, since a <code>null</code> was no longer accepted in place of a string</li>
<li>this also lead me to <a href="https://github.com/facile-it/paraunit/pull/93/commits/6aa9286256ed47c7b4500b990e030588b18b7770">write an additional test</a> for an uncovered, very common case</li>
<li>it made me realize that I had <a href="https://github.com/facile-it/paraunit/pull/93/files#diff-f3225dfaa1d4e63e21a7e51880c63bbbR40">a regex silently failing</a> returning a bad result, and I had to take better care of it, leading to a simpler and more robust approach</li>
<li>this lead to <a href="https://github.com/facile-it/paraunit/pull/93/commits/b5463b122e87f14dbaf6fa2ff78ba53f14ae737a#diff-59b76fc4702a8549daa568e542d71498R42">additional tests too</a></li>
<li>it made me discover a <a href="https://github.com/facile-it/paraunit/pull/93/commits/61c786c6faa0020465abd8243ee1415883193a94#diff-4fd831bf7fb1767a7a49e0954a98fb05R98">specific behavior of the SPL file iterator classes</a></li>
</ul>
<h3 id="strict-types-enforcing">Strict types enforcing</h3>
<p>In the last part of this PR, I also added the <code>declare(strict_types=1)</code> directive everywhere in my code. This directive changes the behavior of type hints: with it, passed values are no longer silently casted (if possible) to the type-hinted, required type, but instead they <strong>trigger an immediate error if the type doesn&rsquo;t match</strong>; for example, passing a <code>&quot;10&quot;</code> string into a <code>int</code> or <code>float</code> type hint will no longer trigger an automatic conversion to <code>10</code> or <code>10.0</code>, but trigger an error.</p>
<p>I would admit that this is a matter of personal preference, and I would not suggest to use this everywhere, especially if there isn&rsquo;t a very thorough test coverage; it may lead to unneeded failures in very unsuspecting places, and it may cause friction when intergrating code with external libraries that take advantage of the implicit type casting that PHP has always done.</p>
<p>But even in this little use case, <a href="https://travis-ci.org/facile-it/paraunit/jobs/236293288">it lead to discover a small issue</a> with an outdated test code, were I was <strong>passing an empty string instead of a boolean</strong>: that happened because I refactored a constructor some time ago, and I forgot to update the tests, and I missed it since the <strong>tests were not failing</strong>. The error was even well highlighted by my IDE now, but before it was casted silently to a bool, and it matched the expected behavior by sheer luck!</p>
<p><img src="/images/phpstorm-error-highlight.png" alt="The error highlighted in PHPStorm"></p>
<h2 id="conclusions">Conclusions</h2>
<p>Type hints and other new PHP language construct help writing more cohesive, rigid code, that may lead to some &ldquo;pain&rdquo; while writing code and (mostly) tests; but this effort is just <strong>paying in advance</strong>: a lot of bugs get discovered earlier, and refactoring and changing code become easier, since pieces of code that doesn&rsquo;t match anymore are more visible.</p>
<p>In the example PR, the amount of changed code that is not method signatures is trivial, but I drastically reduced the amount of possible deviations that my code could take if a wrong value is passed through it, and I fixed and tested a few additional cases that I was forgetting about. Also, the usage of the <code>declare(strict_types=1)</code> enforces even further this approach, raising the confidence that I have in the codebase.</p>

        </div>
        
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/php/" rel="tag">PHP</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/oop/" rel="tag">OOP</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/software-testing/" rel="tag">Software testing</a>
		</li>
	</ul>
</div>
    </article>
</main>

<div class="authorbox clearfix">
	<p class="authorbox__warning">
		<strong>WARNING:</strong> Authorbox is activated, but [Author] parameters are not specified.
	</p>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/how-php-7-tdd-helped-me-sleep-better/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">How PHP 7 &amp; TDD helped me sleep better</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/phpunit-upgrade-namespace/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">How to gradually upgrade toward PHPUnit 6 with namespaced classes</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar">
<div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://duckduckgo.com/">
		<label>
			<input class="widget-search__field" type="search" placeholder="Search…" value="" name="q" aria-label="Search…">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sites" value="https://alessandrolai.dev/"/>
	</form>
</div>
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/releases/pretty-package-versions/2.1.1/">Pretty Package Versions 2.1.1</a></li>
			<li class="widget__item"><a class="widget__link" href="/releases/paraunit/2.6.0/">Paraunit 2.6.0: hide deprecations by configuration</a></li>
			<li class="widget__item"><a class="widget__link" href="/releases/paraunit/2.5.0/">Paraunit 2.5.0: PHPUnit 12 &amp; PHP 8.4 support</a></li>
			<li class="widget__item"><a class="widget__link" href="/releases/pretty-package-versions/2.1.0/">Pretty Package Versions 2.1.0</a></li>
			<li class="widget__item"><a class="widget__link" href="/releases/terminable-loop-command/1.2.3/">Terminable Loop Command 1.2.3</a></li>
		</ul>
	</div>
</div>
<div class="widget-recent widget">
    <h4 class="widget__title">Recent Talks</h4>
    <div class="widget__content">
        <ul class="widget__list">
            <li class="widget__item"><a class="widget__link" href="/talks/2024-phpday-symfony-messenger/">
                Symfony Messenger: the sharpest tool in your PHP toolbox
                <br>
                <small>May 17 @ PHPDay 2024</small>
            </a></li>
            <li class="widget__item"><a class="widget__link" href="/talks/2023-cto-lunch-dual-career-ladder/">
                CTO Luch - Dual Career Ladder
                <br>
                <small>December 21 @ CTO Show</small>
            </a></li>
            <li class="widget__item"><a class="widget__link" href="/talks/2022-cto-show-leading-a-team-smarter-than-you/">
                CTO Show - Leading a team smarter than you
                <br>
                <small>December 21 @ CTO Show</small>
            </a></li>
            <li class="widget__item"><a class="widget__link" href="/talks/2022-phpday-php-ddd-cqrs-es-planned-strategy/">
                PHP &#43; ES &#43; CQRS &#43; DDD = ? - A planned strategy
                <br>
                <small>May 20 @ PHPDay 2022</small>
            </a></li>
            <li class="widget__item"><a class="widget__link" href="/talks/2022-pugmi-come-sfruttare-openapi-durante-sviluppo-api-php/">
                Come sfruttare OpenAPI durante lo sviluppo di un API in PHP
                <br>
                <small>May 4 @ PUGMI</small>
            </a></li>
        </ul>
    </div>
</div>

<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/continuous-deployment/" title="Continuous Deployment">Continuous Deployment</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/continuous-integration/" title="Continuous Integration">Continuous Integration</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/database/" title="Database">Database</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/docker/" title="Docker">Docker</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/doctrine/" title="Doctrine">Doctrine</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/doctrinemysqlcomeback/" title="DoctrineMySQLComeBack">DoctrineMySQLComeBack</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/gitlab/" title="GitLab">GitLab</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/kubernetes/" title="Kubernetes">Kubernetes</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mongodb-messenger-transport/" title="MongoDB Messenger Transport">MongoDB Messenger Transport</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mysql/" title="MySQL">MySQL</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/oop/" title="OOP">OOP</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/open-source/" title="Open Source">Open Source</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/paraunit/" title="Paraunit">Paraunit</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/php/" title="PHP">PHP</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pretty-package-versions/" title="Pretty Package Versions">Pretty Package Versions</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/software-testing/" title="Software Testing">Software Testing</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/symfony/" title="Symfony">Symfony</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/symfony-functional-test-case/" title="Symfony Functional Test Case">Symfony Functional Test Case</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/tdd/" title="TDD">TDD</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/terminable-loop-command/" title="Terminable Loop Command">Terminable Loop Command</a>
	</div>
</div>
<div class="widget-social widget">
	<h4 class="widget-social__title widget__title">Social</h4>
	<div class="widget-social__content widget__content">
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Twitter" rel="noopener noreferrer" href="https://twitter.com/AlessandroLai" target="_blank">
				<svg class="widget-social__link-icon icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5 0-78.8 35.3-78.8 78.8 0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3-6.7 11.6-10.6 25.2-10.6 39.6 0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1 0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4 0-12.6-.4-18.8-1.1 34.9 22.4 76.3 35.4 120.8 35.4 144.9 0 224.1-120 224.1-224.1 0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
				<span>Twitter</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Twitter" rel="me noopener noreferrer" href="https://phpc.social/@alessandrolai" target="_blank">
				<svg class="widget-social__link-icon icon icon-mastodon" width="24px" height="24px" style="fill:#fff" viewBox="2 2 20 20" xmlns="http://www.w3.org/2000/svg" xml:space="preserve"><path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/></svg>

				<span>Mastodon</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="LinkedIn" rel="noopener noreferrer" href="https://linkedin.com/in/alessandro-lai-09440922" target="_blank">
				<svg class="widget-social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0,40v272c0,21.9,18.1,40,40,40h272c21.9,0,40-18.1,40-40V40c0-21.9-18.1-40-40-40H40C18.1,0,0,18.1,0,40z M312,32 c4.6,0,8,3.4,8,8v272c0,4.6-3.4,8-8,8H40c-4.6,0-8-3.4-8-8V40c0-4.6,3.4-8,8-8H312z M59.5,87c0,15.2,12.3,27.5,27.5,27.5 c15.2,0,27.5-12.3,27.5-27.5c0-15.2-12.3-27.5-27.5-27.5C71.8,59.5,59.5,71.8,59.5,87z M187,157h-1v-21h-45v152h47v-75 c0-19.8,3.9-39,28.5-39c24.2,0,24.5,22.4,24.5,40v74h47v-83.5c0-40.9-8.7-72-56.5-72C208.5,132.5,193.3,145.1,187,157z M64,288h47.5 V136H64V288z"/></svg>
				<span>LinkedIn</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="GitHub" rel="noopener noreferrer" href="https://github.com/Jean85" target="_blank">
				<svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0c-106.1 0-192 85.8-192 191.7 0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2 0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8 0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7 0 0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4 0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5 0 25.6-.2 46.3-.2 52.6 0 5.1 3.5 11.1 13.2 9.2 76.2-25.5 131.2-97.3 131.2-182 0-105.9-86-191.7-192-191.7z"/></svg>
				<span>GitHub</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="GitLab" rel="noopener noreferrer" href="https://gitlab.com/Alessandro.Lai" target="_blank">
				<svg class="widget-social__link-icon icon icon-gitlab" width="24" height="24" viewBox="0 0 265 265"><path d="M128.075 236.075l47.104-144.97H80.97l47.104 144.97z M14.956 91.104L.642 135.16a9.752 9.752 0 0 0 3.542 10.903l123.891 90.012-113.12-144.97z M14.956 91.105H80.97L52.601 3.79c-1.46-4.493-7.816-4.492-9.275 0l-28.37 87.315z M241.194 91.104l14.314 44.056a9.752 9.752 0 0 1-3.543 10.903l-123.89 90.012 113.119-144.97z M241.194 91.105h-66.015l28.37-87.315c1.46-4.493 7.816-4.492 9.275 0l28.37 87.315z"/></svg>
				<span>GitLab</span>
			</a>
		</div>

		
	</div>
</div>

</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2025 Alessandro Lai.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>